(this["webpackJsonpproject-bg"]=this["webpackJsonpproject-bg"]||[]).push([[0],[,,,,,,,,function(e,n,t){},function(e,n,t){},,,,,,,function(e,n,t){},,function(e,n,t){},function(e,n,t){},,,,,,,function(e,n){function t(e){var n=new Error("Cannot find module '"+e+"'");throw n.code="MODULE_NOT_FOUND",n}t.keys=function(){return[]},t.resolve=t,e.exports=t,t.id=26},function(e,n,t){},function(e,n,t){},function(e,n,t){},function(e,n,t){},function(e,n,t){"use strict";t.r(n);var c=t(1),r=t(10),a=t.n(r),l=t(2),u=t(3),o=(t(16),t(0)),i=function(e){e.gamePhase;return Object(o.jsx)("div",{id:"bg",children:Object(o.jsx)("div",{className:"noise"})})};i.defaultProps={gamePhase:null};var s=i,b=(t(18),function(e){var n=e.text,t=e.icon,c=e.onClick,r=e.disabled;return Object(o.jsxs)("button",{className:"simple-button"+(r?" disabled":""),type:"button",onClick:c,children:[t&&Object(o.jsx)("span",{className:"material-icons-round",children:t}),n&&n]})});b.defaultProps={text:null,icon:null,onClick:function(){},disabled:!1};var d=b,j=(t(19),function(e){var n=e.label,t=e.value,r=e.setValue,a=e.placeholder,l=e.onKeyPressEnter,i=Object(c.useState)(!1),s=Object(u.a)(i,2),b=s[0],d=s[1],j=Object(c.useCallback)((function(e){r(e.target.value)})),f=Object(c.useCallback)((function(){d(!0)})),p=Object(c.useCallback)((function(){d(!1)})),O=Object(c.useCallback)((function(e){if(e||(e=window.event),"Enter"===(e.code||e.key)&&l)return l(),!1}));return Object(o.jsxs)("div",{className:"text-input"+(b?" active":"")+(t?" filled":""),children:[Object(o.jsx)("label",{children:n}),Object(o.jsx)("input",{type:"text",value:t,onChange:j,placeholder:a,onFocus:f,onBlur:p,required:"required",onKeyPress:O})]})});j.defaultProps={label:null,value:null,placeholder:null,onKeyPressEnter:null};var f=j,p="0.0.3",O="menu",y="lobby_pregame",m="join_lobby_pregame",x="character_selection",v="CLIENT_DATA",g=t(4),h=t.n(g),C=t(7),k=t(11),I=function(){for(var e=[],n="ABCDEFGHIJKLMNOPQRSTUVWXYZ",t=0;t<4;t++)e.push(n.charAt(Math.floor(Math.random()*n.length)));return e.join("")},N=t.n(k)()(["https://project-bg.herokuapp.com/gun"]),_=!1,S=function(e){N.get(e).put({key:null})},w=function(e,n){N.get(e).once((function(e){console.log("Game downloaded: ",e),n(e)}))},D=function(e,n){N.get(e).on((function(e,t,c,r){n(e)}),!0)},P=function(e){return new Promise((function(n){N.get(e).once((function(t){(null===t||void 0===t?void 0:t.key)?(console.log("The game "+e+" exists: ",t),n(!0)):(console.log("The game "+e+" doesn't exists: ",t),n(!1))}))}))},L=function(e,n){return new Promise((function(t){N.get(e).once((function(c){(null===c||void 0===c?void 0:c.creatorDeviceId)===n.deviceId?(console.log("The game "+e+" is mine: ",c),t(!0)):(console.log("The game "+e+" is not mine: ",c),t(!1))}))}))},K=function(){var e=Object(C.a)(h.a.mark((function e(n,t,c,r){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(_&&M(_,t),console.log("Joining game: ",n),n&&4===n.length){e.next=4;break}return e.abrupt("return",!1);case 4:return e.next=6,P(n);case 6:e.sent&&(w(n,c),D(n,c),_=n,r());case 8:case"end":return e.stop()}}),e)})));return function(n,t,c,r){return e.apply(this,arguments)}}(),M=function(){var e=Object(C.a)(h.a.mark((function e(n,t){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n){e.next=2;break}return e.abrupt("return");case 2:return console.log("Leaving game: ",n),N.get(n).off(),_=null,e.next=7,L(n,t);case 7:e.sent&&S(n);case 9:case"end":return e.stop()}}),e)})));return function(n,t){return e.apply(this,arguments)}}(),G=(t(27),function(e){var n=e.clientData,t=e.changeUserName,r=e.changeCurrentLobbyKey,a=e.changeClientScene,l=e.mergeGameData,i=e.resetGameData,s=Object(c.useState)(n.userName),b=Object(u.a)(s,2),j=b[0],O=b[1],x=Object(c.useCallback)((function(){t(j);var e=function(e){var n={key:I(),appVersion:p,creatorDeviceId:e.deviceId};return N.get(n.key).put(n,(function(e){return console.log("Created game: ",e)})),n}(n);K(e.key,n,l,(function(){r(e.key),a(y)}))}),[j,n,l]),v=Object(c.useCallback)((function(){t(j),a(m)}),[j]),g=Object(c.useCallback)((function(){t(j),K(n.currentLobbyKey,n,l,(function(){a(y)}))}),[j,n,l]),h=Object(c.useCallback)((function(){M(n.currentLobbyKey,n),r(null),i()}),[n]);return Object(o.jsxs)("div",{id:"menu",children:[Object(o.jsx)(f,{label:"Name",value:j,setValue:O}),n.currentLobbyKey&&Object(o.jsxs)(o.Fragment,{children:[Object(o.jsx)(d,{text:"Continue campaign "+n.currentLobbyKey,icon:"navigate_next",onClick:g}),Object(o.jsx)(d,{text:"Leave campaign "+n.currentLobbyKey,icon:"logout",onClick:h})]}),!n.currentLobbyKey&&Object(o.jsxs)(o.Fragment,{children:[Object(o.jsx)(d,{text:"Create campaign",icon:"add",onClick:x,disabled:0===j.length}),Object(o.jsx)(d,{text:"Join campaign",icon:"login",onClick:v,disabled:0===j.length})]}),Object(o.jsx)("span",{className:"version",children:p})]})});G.defaultProps={};var B=G,Y=(t(8),function(e){var n=e.color,t=e.userName,r=e.itsAMe,a=e.onSelectPlayer,l=Object(c.useMemo)((function(){return["player",n,t?null:"locked"].filter((function(e){return!!e})).join(" ")}),[n,t]),u=Object(c.useMemo)((function(){return t?r?t+" (you)":t:"Player "+n+" (bot)"}),[t,n,r]);return Object(o.jsxs)("div",{className:l,onClick:a,children:[t?Object(o.jsx)("span",{className:"icon material-icons-round",children:"face"}):Object(o.jsx)("span",{className:"icon material-icons-outlined",children:"smart_toy"}),Object(o.jsx)("span",{children:u})]})});Y.defaultProps={userName:null};var E=Y,U=function(e){var n=e.clientData,t=e.gameData,r=e.changePlayerId,a=e.changeClientScene,l=Object(c.useCallback)((function(e){t[e+"_deviceId"]||(!function(e){if(_&&e.playerId){var n={};n[e.playerId+"_deviceId"]=null,n[e.playerId+"_userName"]=null,n[e.playerId+"_clientScene"]=null,n[e.playerId+"_cursorX"]=null,n[e.playerId+"_cursorY"]=null,n[e.playerId+"_cursorHide"]=null,n[e.playerId+"_cursorText"]=null,N.get(_).put(n)}}(n),r(e))}),[n]);return Object(o.jsxs)("div",{id:"pregame",children:[Object(o.jsxs)("div",{className:"lobby-key",children:["Lobby code:",Object(o.jsx)("span",{className:"selectable",children:n.currentLobbyKey})]}),Object(o.jsx)(E,{color:"blue",userName:null===t||void 0===t?void 0:t.playerBlue_userName,itsAMe:(null===t||void 0===t?void 0:t.playerBlue_deviceId)===n.deviceId,onSelectPlayer:function(){return l("playerBlue")}}),Object(o.jsx)(E,{color:"red",userName:null===t||void 0===t?void 0:t.playerRed_userName,itsAMe:(null===t||void 0===t?void 0:t.playerRed_deviceId)===n.deviceId,onSelectPlayer:function(){return l("playerRed")}}),Object(o.jsx)(E,{color:"green",userName:null===t||void 0===t?void 0:t.playerGreen_userName,itsAMe:(null===t||void 0===t?void 0:t.playerGreen_deviceId)===n.deviceId,onSelectPlayer:function(){return l("playerGreen")}}),Object(o.jsx)(E,{color:"yellow",userName:null===t||void 0===t?void 0:t.playerYellow_userName,itsAMe:(null===t||void 0===t?void 0:t.playerYellow_deviceId)===n.deviceId,onSelectPlayer:function(){return l("playerYellow")}}),Object(o.jsx)(d,{text:"Back",icon:"arrow_back",onClick:function(){return a(O)}}),Object(o.jsx)(d,{text:"Start",icon:"play_arrow",onClick:function(){return a(x)}})]})};U.defaultProps={gameData:null};var T=U,A=(t(28),function(e){var n=e.clientData,t=e.changeCurrentLobbyKey,r=e.changeClientScene,a=e.mergeGameData,l=Object(c.useState)(""),i=Object(u.a)(l,2),s=i[0],b=i[1],j=Object(c.useCallback)((function(){K(s,n,a,(function(){t(s),r(y)}))}),[s,n,a]),p=Object(c.useCallback)((function(e){b(e.toUpperCase())}),[]);return Object(o.jsxs)("div",{id:"join_pregame",children:[Object(o.jsx)(f,{label:"Lobby code",value:s,setValue:p,onKeyPressEnter:j}),Object(o.jsx)(d,{text:"Back",icon:"arrow_back",onClick:function(){return r(O)}}),Object(o.jsx)(d,{text:"Join campaign",icon:"login",onClick:j,disabled:4!==s.length})]})});A.defaultProps={};var J=A,R=(t(29),function(e){var n=e.changeClientScene;return Object(o.jsxs)("div",{id:"character_selection",children:[Object(o.jsx)("div",{}),Object(o.jsx)("div",{}),Object(o.jsx)("div",{}),Object(o.jsx)("div",{}),Object(o.jsx)(d,{text:"Back",icon:"arrow_back",onClick:function(){return n(y)}})]})});R.defaultProps={};var V=R,H=(t(9),function(e){var n=e.playerId,t=e.cursorData,r=e.changeCursorX,a=e.changeCursorY,l=e.changeCursorHide,u=e.changeCursorUp,i=e.changeCursorDown,s=Object(c.useMemo)((function(){switch(n){case"playerBlue":return"blue";case"playerRed":return"red";case"playerGreen":return"green";case"playerYellow":return"yellow";default:return null}}),[n]),b=Object(c.useMemo)((function(){return["cursor",t.hide?"hidden":null,t.mouseDown?"down":null,t.mouseUp?"up":null,s].filter((function(e){return!!e})).join(" ")}),[s,t.hide,t.mouseDown,t.mouseUp]),d=Object(c.useCallback)((function(e){var n=e||window.event;r(n.x),a(n.y)}),[]),j=Object(c.useCallback)((function(){l(!1)}),[]),f=Object(c.useCallback)((function(){u(!1),l(!0)}),[]),p=Object(c.useCallback)((function(){u(!1),i(!0)}),[]),O=Object(c.useCallback)((function(){i(!1),u(!0)}),[]),y=Object(c.useCallback)((function(e){return e.preventDefault(),!1}),[]);return Object(c.useEffect)((function(){document.onmousemove=d,document.onmouseenter=j,document.onmouseleave=f,document.onmousedown=p,document.onmouseup=O,document.oncontextmenu=y})),Object(o.jsxs)("div",{className:b,style:{transform:"translate("+t.x+"px, "+t.y+"px)"},children:[Object(o.jsx)("div",{className:"goccia"}),Object(o.jsx)("div",{className:"text",children:t.text})]})});H.defaultProps={playerId:null};var F=H,X=function(e){var n=e.playerId,t=e.gameData;if(!t||!t[n+"_userName"])return null;var r=Object(c.useMemo)((function(){switch(n){case"playerBlue":return"blue";case"playerRed":return"red";case"playerGreen":return"green";case"playerYellow":return"yellow";default:return null}}),[n]),a=Object(c.useMemo)((function(){return["cursor",t[n+"_cursorHide"]?"hidden":null,r].filter((function(e){return!!e})).join(" ")}),[r,t[n+"_cursorHide"]]);return Object(o.jsxs)("div",{className:a,style:{transform:"translate("+t[n+"_cursorX"]+"px, "+t[n+"_cursorY"]+"px)"},children:[Object(o.jsx)("div",{className:"goccia"}),Object(o.jsx)("div",{className:"text",children:t[n+"_cursorText"]})]})};X.defaultProps={playerId:null,gameData:null};var q=X,Q=(t(30),function(){var e=Object(c.useState)((function(){var e=JSON.parse(localStorage.getItem(v));if(e.appVersion===p)return Object(l.a)(Object(l.a)({},e),{},{clientScene:O});var n={appVersion:p,deviceId:"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var n=16*Math.random()|0;return("x"==e?n:3&n|8).toString(16)})),clientScene:O,userName:"",currentLobbyKey:null,playerId:null,cursor:{x:0,y:0,mouseUp:!1,mouseDown:!1,hide:!0,text:""}};return(null===e||void 0===e?void 0:e.appVersion)!==p&&e.deviceId?Object(l.a)(Object(l.a)({},n),{},{deviceId:e.deviceId,userName:e.userName}):n})),n=Object(u.a)(e,2),t=n[0],r=n[1];Object(c.useEffect)((function(){!function(e){if(_&&e.playerId){var n={};n[e.playerId+"_deviceId"]=e.deviceId,n[e.playerId+"_userName"]=e.userName,n[e.playerId+"_clientScene"]=e.clientScene,e.clientScene===x&&(n[e.playerId+"_cursorX"]=e.cursor.x,n[e.playerId+"_cursorY"]=e.cursor.y,n[e.playerId+"_cursorHide"]=e.cursor.hide,n[e.playerId+"_cursorText"]=e.cursor.text),N.get(_).put(n)}}(t),localStorage.setItem(v,JSON.stringify(t))}),[t]);var a=Object(c.useCallback)((function(e){r((function(n){return Object(l.a)(Object(l.a)({},n),{},{clientScene:e})}))}),[]),i=Object(c.useCallback)((function(e){r((function(n){return Object(l.a)(Object(l.a)({},n),{},{userName:e})}))}),[]),b=Object(c.useCallback)((function(e){r((function(n){return Object(l.a)(Object(l.a)({},n),{},{currentLobbyKey:e})}))}),[]),d=Object(c.useCallback)((function(e){r((function(n){return Object(l.a)(Object(l.a)({},n),{},{playerId:e})}))}),[]),j=Object(c.useCallback)((function(e){r((function(n){return Object(l.a)(Object(l.a)({},n),{},{cursor:Object(l.a)(Object(l.a)({},n.cursor),{},{x:e,hide:!1})})}))}),[]),f=Object(c.useCallback)((function(e){r((function(n){return Object(l.a)(Object(l.a)({},n),{},{cursor:Object(l.a)(Object(l.a)({},n.cursor),{},{y:e,hide:!1})})}))}),[]),g=Object(c.useCallback)((function(e){r((function(n){return Object(l.a)(Object(l.a)({},n),{},{cursor:Object(l.a)(Object(l.a)({},n.cursor),{},{mouseUp:e})})}))}),[]),h=Object(c.useCallback)((function(e){r((function(n){return Object(l.a)(Object(l.a)({},n),{},{cursor:Object(l.a)(Object(l.a)({},n.cursor),{},{mouseDown:e})})}))}),[]),C=Object(c.useCallback)((function(e){r((function(n){return Object(l.a)(Object(l.a)({},n),{},{cursor:Object(l.a)(Object(l.a)({},n.cursor),{},{hide:e})})}))}),[]),k=Object(c.useState)(null),I=Object(u.a)(k,2),S=I[0],w=I[1],D=Object(c.useCallback)((function(e){w((function(n){return Object(l.a)(Object(l.a)({},n),e)}))}),[]),P=Object(c.useCallback)((function(){w(null)}),[]);return Object(c.useEffect)((function(){console.log("gameData changed: ",Object(l.a)({},S))}),[S]),Object(o.jsxs)(o.Fragment,{children:[Object(o.jsx)(s,{}),O===t.clientScene&&Object(o.jsx)(B,{clientData:t,changeUserName:i,changeCurrentLobbyKey:b,changeClientScene:a,mergeGameData:D,resetGameData:P}),y===t.clientScene&&Object(o.jsx)(T,{clientData:t,gameData:S,changePlayerId:d,changeClientScene:a}),m===t.clientScene&&Object(o.jsx)(J,{clientData:t,changeCurrentLobbyKey:b,changeClientScene:a,mergeGameData:D}),x===t.clientScene&&Object(o.jsx)(V,{changeClientScene:a}),x===t.clientScene&&"playerBlue"!==t.playerId&&Object(o.jsx)(q,{playerId:"playerBlue",gameData:S}),x===t.clientScene&&"playerRed"!==t.playerId&&Object(o.jsx)(q,{playerId:"playerRed",gameData:S}),x===t.clientScene&&"playerGreen"!==t.playerId&&Object(o.jsx)(q,{playerId:"playerGreen",gameData:S}),x===t.clientScene&&"playerYellow"!==t.playerId&&Object(o.jsx)(q,{playerId:"playerYellow",gameData:S}),t.cursor&&Object(o.jsx)(F,{playerId:t.playerId,cursorData:t.cursor,changeCursorX:j,changeCursorY:f,changeCursorUp:g,changeCursorDown:h,changeCursorHide:C})]})});a.a.render(Object(o.jsx)(Q,{}),document.getElementById("app"))}],[[31,1,2]]]);
//# sourceMappingURL=main.af5c9b18.chunk.js.map